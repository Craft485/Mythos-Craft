(()=>{"use strict";const e=document.getElementById("card-display"),t=document.getElementById("decks-display"),n=document.getElementById("context-menu");let c=null;const a={};let r=null;function d(e,t){const n=document.createElement("div");n.className="card";const c=document.createElement("h3");c.innerHTML=`<b>${e.name}</b>`;const a=document.createElement("div");a.className="card-count-display",a.innerText=`x${t}`;const r=document.createElement("div");return r.innerHTML=`<span class="card-cost-display">${e.cost}</span> / <span class="card-health-display">${e.health}</span> / <span class="card-attack-display">${e.attack}</span>`,n.appendChild(c),n.appendChild(a),n.appendChild(document.createElement("br")),n.appendChild(r),n}function l(e,t){const n=document.getElementById("card-preview-overlay");n&&n.remove();const c=[];Array.from(document.querySelectorAll(`#${Array.from(document.getElementById("display-container").children)[Array.from(document.querySelectorAll("#card-display-filters > input")).findIndex((e=>e.id===document.querySelector("#card-display-filters > input:checked").id))].id} > .card`)).forEach((e=>{c.push([e,e.style.display||null]),e.style.display="none"}));const a=document.createElement("div");a.id="card-preview-overlay";const l=document.createElement("button");l.id="cancel-card-preview-overlay",l.innerText="X",l.onclick=()=>{c.forEach((e=>e[1]?e[0].style.display=e[1]:e[0].removeAttribute("style"))),a.remove()},a.appendChild(l);const o=r[e],s=d(o,t);s.id="card-preview-card-panel";const i=document.createElement("div");i.id="card-preview-break-down-panel";const m=document.createElement("ul");m.id="card-preview-stats-panel";const u=document.createElement("li");u.className="card-rarity-display",u.innerText="Rarity: N/A";const p=document.createElement("li");p.className="card-attack-display",p.innerText=`Base attack: ${o.attack||"N/A"}`;const y=document.createElement("li");y.className="card-health-display",y.innerText=`Base health: ${o.health||"N/A"}`;const h=document.createElement("li");h.className="card-cost-display",h.innerText=`Base cost: ${o.cost||"N/A"}`,m.appendChild(u),m.appendChild(h),m.appendChild(y),m.appendChild(p),i.appendChild(m);const v=document.createElement("p");v.id="card-preview-information-panel",v.innerHTML=o.description;const f=document.createElement("p");return f.id="card-preview-information-panel-indepth",f.innerHTML="Work in Progress | Information pending",a.appendChild(s),a.appendChild(i),a.appendChild(v),a.appendChild(f),a}document.getElementById("signout").onclick=()=>fetch("signout",{method:"POST"}).then((()=>window.location.pathname="/")),window.onload=async function(){(await fetch("cardlist",{method:"POST"})).json().then((o=>{if(console.log(o),o.success){r=o.status.cardList,console.log(r),document.getElementById("user-name-display").innerText=o.status.userData.username||"null",document.getElementById("orichalcum-display").innerText=`${o.status.orichalcum}`||"0";for(const t in o.status.inventory){const a=d(o.status.cardList[t],o.status.inventory[t]);a.addEventListener("contextmenu",(e=>{e.preventDefault(),n.style.display="initial",n.style.left=`${e.clientX}px`,n.style.top=`${e.clientY}px`,c=a,Array.from(document.querySelectorAll(".sub-menu-active")).forEach((e=>e.classList.remove("sub-menu-active")))})),a.onclick=()=>{e.appendChild(l(t,o.status.inventory[t]))},e.appendChild(a)}for(const e of o.status.deckData){const o=JSON.parse(e.cards);a[e.name]={id:e.deckID,cards:o};const s=()=>Object.values(a[e.name].cards).reduce(((e,t)=>e+t),0),i=document.getElementById("add-to-deck-sub-menu"),m=document.getElementById("remove-from-deck-sub-menu"),u=document.createElement("p"),p=document.createElement("p");u.innerText=e.name,u.className="sub-menu-item add-to-deck-sub-menu-item",p.innerText=e.name,p.className="sub-menu-item add-to-deck-sub-menu-item",u.onclick=async()=>{const n=c.firstElementChild.innerText;(await fetch(`addCardToDeck?cardName=${n}&deckName=${e.name}`,{method:"POST"})).json().then((c=>{if(c.success)a[e.name].cards[n]?a[e.name].cards[n]++:a[e.name].cards[n]=1,Array.from(t.children).find((t=>t.innerText.includes(e.name))).querySelector(".card-count-display").innerText=`x${s()}`,document.getElementById("deck-preview-overlay-display")&&(Array.from(document.getElementById("deck-preview-overlay-display").children).find((e=>e.innerText.includes(n))).querySelector(".card-count-display").innerText=`x${a[e.name].cards[n]}`);else switch(c.state){case 0:window.location.pathname="/";break;case-1:console.error(`Encountered 5XX: ${c.status}`);break;case-2:console.warn("Encountered 4XX, aborted request");break;default:console.error("Unknown response received from server")}}))},p.onclick=async()=>{const n=c.firstElementChild.innerText;(await fetch(`removeCardFromDeck?cardName=${n}&deckName=${e.name}`,{method:"POST"})).json().then((c=>{if(c.success){if(a[e.name].cards[n]--,Array.from(t.children).find((t=>t.innerText.includes(e.name))).querySelector(".card-count-display").innerText=`x${s()}`,document.getElementById("deck-preview-overlay-display")){const t=Array.from(document.getElementById("deck-preview-overlay-display").children).find((e=>e.innerText.includes(n)))||null;t.querySelector(".card-count-display").innerText=`x${a[e.name].cards[n]}`,a[e.name].cards[n]<=0&&(delete a[e.name].cards[n],t&&t.remove())}}else switch(c.state){case 0:window.location.pathname="/";break;case-1:console.error(`Encountered 5XX: ${c.status}`);break;case-2:console.warn("Encountered 4XX, aborted request");break;default:console.error("Unknown response received from server")}}))},i.appendChild(u),m.appendChild(p);const y=document.createElement("div");y.className="card deck-title-card";const h=document.createElement("h3");h.innerHTML=`<b>${e.name}</b>`;const v=document.createElement("div");v.className="card-count-display",v.innerText=`x${s()}`,y.appendChild(h),y.appendChild(v),y.appendChild(document.createElement("hr")),y.onclick=()=>{const o=document.createElement("div");o.id="deck-preview-overlay";const s=document.createElement("button");s.id="cancel-deck-preview-overlay",s.innerText="X",s.onclick=()=>o.remove(),o.appendChild(s);const i=document.createElement("div");i.id="deck-preview-overlay-display";for(const[t,s]of Object.entries(a[e.name].cards)){const e=d(r[t],s);e.addEventListener("contextmenu",(t=>{t.preventDefault(),n.style.display="initial",n.style.left=`${t.clientX}px`,n.style.top=`${t.clientY}px`,c=e,Array.from(document.querySelectorAll(".sub-menu-active")).forEach((e=>e.classList.remove("sub-menu-active")))})),e.onclick=()=>{o.appendChild(l(t,s))},i.appendChild(e)}o.appendChild(i),t.appendChild(o)},t.appendChild(y)}}else-1===o.state?document.getElementById("display-container").innerText=`${o.status}`:0===o.state&&(window.location.pathname="/")})),function(){const e=Array.from(document.querySelectorAll("#card-display-filters > label"));for(const t of e)t.addEventListener("click",(e=>{e.preventDefault(),document.querySelectorAll('[id*="overlay"]').forEach((e=>e.remove())),document.querySelectorAll('.card[style="display: none;"]').forEach((e=>e.removeAttribute("style"))),Array.from(document.querySelectorAll('#card-display-filters > input[type="checkbox"]')).find((e=>e.checked)).checked=!1,document.querySelector(`#${t.htmlFor.toLowerCase()}`).checked=!0,document.querySelector("#display-container > section[style]")?.removeAttribute("style"),document.querySelector(`#display-container > section[name="${t.htmlFor.toLowerCase()}"]`).style.display="flex"}));document.querySelector("#display-container > :first-child").style.display="flex",document.body.parentElement.onclick=e=>{e.target.className.includes("context-menu")||e.target.id.includes("context-menu")||e.target.className.includes("sub-menu")||(n.style.display="none",Array.from(document.querySelectorAll(".sub-menu-active")).forEach((e=>e.classList.remove("sub-menu-active"))),c=null)},Array.from(document.querySelectorAll(".has-sub-menu > p")).forEach((e=>e.onclick=()=>{e.parentElement.classList.contains("sub-menu-active")?e.parentElement.classList.remove("sub-menu-active"):(document.querySelector(".sub-menu-active")?.classList.remove("sub-menu-active"),e.parentElement.classList.add("sub-menu-active"))})),document.getElementById("context-menu-inspect-item").onclick=()=>c?.click()}()}})();