(()=>{"use strict";const e=document.getElementById("card-display"),t=document.getElementById("decks-display"),n=document.getElementById("context-menu");let a=null;const c={};let r=null;function d(e,t){const n=document.createElement("div");n.className="card";const a=document.createElement("h3");a.innerHTML=`<b>${e.name}</b>`;const c=document.createElement("div");c.className="card-count-display",c.innerText=`x${t}`;const r=document.createElement("div");return r.innerHTML=`<span class="card-cost-display">${e.cost}</span> / <span class="card-health-display">${e.health}</span> / <span class="card-attack-display">${e.attack}</span>`,n.appendChild(a),n.appendChild(c),n.appendChild(document.createElement("br")),n.appendChild(r),n}function s(e,t){const n=document.getElementById("card-preview-overlay");n&&n.remove();const a=[];Array.from(document.querySelectorAll(`#${Array.from(document.getElementById("display-container").children)[Array.from(document.querySelectorAll("#card-display-filters > input")).findIndex((e=>e.id===document.querySelector("#card-display-filters > input:checked").id))].id} > .card`)).forEach((e=>{a.push([e,e.style.display||null]),e.style.display="none"}));const c=document.createElement("div");c.id="card-preview-overlay";const s=document.createElement("button");s.id="cancel-card-preview-overlay",s.innerText="X",s.onclick=()=>{a.forEach((e=>e[1]?e[0].style.display=e[1]:e[0].removeAttribute("style"))),c.remove()},c.appendChild(s);const l=r[e],o=d(l,t);o.id="card-preview-card-panel";const i=document.createElement("div");i.id="card-preview-break-down-panel";const m=document.createElement("ul");m.id="card-preview-stats-panel";const u=document.createElement("li");u.className="card-rarity-display",u.innerText="Rarity: N/A";const p=document.createElement("li");p.className="card-attack-display",p.innerText=`Base attack: ${l.attack||"N/A"}`;const y=document.createElement("li");y.className="card-health-display",y.innerText=`Base health: ${l.health||"N/A"}`;const h=document.createElement("li");h.className="card-cost-display",h.innerText=`Base cost: ${l.cost||"N/A"}`,m.appendChild(u),m.appendChild(h),m.appendChild(y),m.appendChild(p),i.appendChild(m);const v=document.createElement("p");v.id="card-preview-information-panel",v.innerHTML=l.description;const f=document.createElement("p");return f.id="card-preview-information-panel-indepth",f.innerHTML="Work in Progress | Information pending",c.appendChild(o),c.appendChild(i),c.appendChild(v),c.appendChild(f),c}document.getElementById("signout").onclick=()=>fetch("signout",{method:"POST"}).then((()=>window.location.pathname="/")),window.onload=async function(){(await fetch("cardlist",{method:"POST"})).json().then((l=>{if(console.log(l),l.success){r=l.status.cardList,console.log(r),document.getElementById("user-name-display").innerText=l.status.userData.username||"null",document.getElementById("orichalcum-display").innerText=`${l.status.orichalcum||0}`,document.getElementById("current-exp").innerText=`${l.status.userData.exp||0}`,document.getElementById("progress").style=`--progress: ${l.status.userData.exp/l.status.userData.expForNextLevel*100||0}%;`,document.getElementById("next-level-exp").innerText=`${l.status.userData.expForNextLevel||0}`,document.getElementById("user-level-display").innerText=`${l.status.userData.level||0}`,document.getElementById("games-won-display").innerText=`${l.status.userData.gamesWon||0}`,document.getElementById("games-played-display").innerText=`${l.status.userData.gamesPlayed||0}`;for(const t in l.status.inventory){const c=d(l.status.cardList[t],l.status.inventory[t]);c.addEventListener("contextmenu",(e=>{e.preventDefault(),n.style.display="initial",n.style.left=`${e.clientX}px`,n.style.top=`${e.clientY}px`,a=c,Array.from(document.querySelectorAll(".sub-menu-active")).forEach((e=>e.classList.remove("sub-menu-active")))})),c.onclick=()=>{e.appendChild(s(t,l.status.inventory[t]))},e.appendChild(c)}for(const e of l.status.deckData){const l=JSON.parse(e.cards);c[e.name]={id:e.deckID,cards:l};const o=()=>Object.values(c[e.name].cards).reduce(((e,t)=>e+t),0),i=document.getElementById("add-to-deck-sub-menu"),m=document.getElementById("remove-from-deck-sub-menu"),u=document.createElement("p"),p=document.createElement("p");u.innerText=e.name,u.className="sub-menu-item add-to-deck-sub-menu-item",p.innerText=e.name,p.className="sub-menu-item add-to-deck-sub-menu-item",u.onclick=async()=>{const n=a.firstElementChild.innerText;(await fetch(`addCardToDeck?cardName=${n}&deckName=${e.name}`,{method:"POST"})).json().then((a=>{if(a.success)c[e.name].cards[n]?c[e.name].cards[n]++:c[e.name].cards[n]=1,Array.from(t.children).find((t=>t.innerText.includes(e.name))).querySelector(".card-count-display").innerText=`x${o()}`,document.getElementById("deck-preview-overlay-display")&&(Array.from(document.getElementById("deck-preview-overlay-display").children).find((e=>e.innerText.includes(n))).querySelector(".card-count-display").innerText=`x${c[e.name].cards[n]}`);else switch(a.state){case 0:window.location.pathname="/";break;case-1:console.error(`Encountered 5XX: ${a.status}`);break;case-2:console.warn("Encountered 4XX, aborted request");break;default:console.error("Unknown response received from server")}}))},p.onclick=async()=>{const n=a.firstElementChild.innerText;(await fetch(`removeCardFromDeck?cardName=${n}&deckName=${e.name}`,{method:"POST"})).json().then((a=>{if(a.success){if(c[e.name].cards[n]--,Array.from(t.children).find((t=>t.innerText.includes(e.name))).querySelector(".card-count-display").innerText=`x${o()}`,document.getElementById("deck-preview-overlay-display")){const t=Array.from(document.getElementById("deck-preview-overlay-display").children).find((e=>e.innerText.includes(n)))||null;t.querySelector(".card-count-display").innerText=`x${c[e.name].cards[n]}`,c[e.name].cards[n]<=0&&(delete c[e.name].cards[n],t&&t.remove())}}else switch(a.state){case 0:window.location.pathname="/";break;case-1:console.error(`Encountered 5XX: ${a.status}`);break;case-2:console.warn("Encountered 4XX, aborted request");break;default:console.error("Unknown response received from server")}}))},i.appendChild(u),m.appendChild(p);const y=document.createElement("div");y.className="card deck-title-card";const h=document.createElement("h3");h.innerHTML=`<b>${e.name}</b>`;const v=document.createElement("div");v.className="card-count-display",v.innerText=`x${o()}`,y.appendChild(h),y.appendChild(v),y.appendChild(document.createElement("hr")),y.onclick=()=>{const l=document.createElement("div");l.id="deck-preview-overlay";const o=document.createElement("button");o.id="cancel-deck-preview-overlay",o.innerText="X",o.onclick=()=>l.remove(),l.appendChild(o);const i=document.createElement("div");i.id="deck-preview-overlay-display";for(const[t,o]of Object.entries(c[e.name].cards)){const e=d(r[t],o);e.addEventListener("contextmenu",(t=>{t.preventDefault(),n.style.display="initial",n.style.left=`${t.clientX}px`,n.style.top=`${t.clientY}px`,a=e,Array.from(document.querySelectorAll(".sub-menu-active")).forEach((e=>e.classList.remove("sub-menu-active")))})),e.onclick=()=>{l.appendChild(s(t,o))},i.appendChild(e)}l.appendChild(i),t.appendChild(l)},t.appendChild(y)}}else-1===l.state?document.getElementById("display-container").innerText=`${l.status}`:0===l.state&&(window.location.pathname="/")})),function(){const e=Array.from(document.querySelectorAll("#card-display-filters > label"));for(const t of e)t.addEventListener("click",(e=>{e.preventDefault(),document.querySelectorAll('[id*="overlay"]').forEach((e=>e.remove())),document.querySelectorAll('.card[style="display: none;"]').forEach((e=>e.removeAttribute("style"))),Array.from(document.querySelectorAll('#card-display-filters > input[type="checkbox"]')).find((e=>e.checked)).checked=!1,document.querySelector(`#${t.htmlFor.toLowerCase()}`).checked=!0,document.querySelector("#display-container > section[style]")?.removeAttribute("style"),document.querySelector(`#display-container > section[name="${t.htmlFor.toLowerCase()}"]`).style.display="flex"}));document.querySelector("#display-container > :first-child").style.display="flex",document.body.parentElement.onclick=e=>{e.target.className.includes("context-menu")||e.target.id.includes("context-menu")||e.target.className.includes("sub-menu")||(n.style.display="none",Array.from(document.querySelectorAll(".sub-menu-active")).forEach((e=>e.classList.remove("sub-menu-active"))),a=null)},Array.from(document.querySelectorAll(".has-sub-menu > p")).forEach((e=>e.onclick=()=>{e.parentElement.classList.contains("sub-menu-active")?e.parentElement.classList.remove("sub-menu-active"):(document.querySelector(".sub-menu-active")?.classList.remove("sub-menu-active"),e.parentElement.classList.add("sub-menu-active"))})),document.getElementById("context-menu-inspect-item").onclick=()=>a?.click()}()}})();